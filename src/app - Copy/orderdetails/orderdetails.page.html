<ion-header>
  <ion-toolbar color="grey">
    <ion-title color="primary">طلباتي</ion-title>
    <ion-row>
      <ion-col size="1">
        <div class="header-icon">
          <!-- <ion-icon name="menu" color="primary"></ion-icon> -->
          <ion-menu-button name="menu" color="primary"></ion-menu-button>
        </div>
      </ion-col>
      <ion-col size="9">
        <ion-searchbar placeholder="البحث"></ion-searchbar>
      </ion-col>
      <ion-col size="2">
        <div class="header-icon" routerLink="/notifications">
          <ion-badge *ngIf="countNotification > 0">{{countNotification}}</ion-badge>
          <ion-icon name="notifications" color="primary"></ion-icon>
        </div>
      </ion-col>
    </ion-row>
  </ion-toolbar>
</ion-header>

<ion-content class="order-page">
  <ion-text class="ion-padding-horizontal">
    تفاصيل الطلب
  </ion-text>

  <ion-card color="light">
    <ion-card-content class="ion-no-padding" *ngIf="order">
      <ion-row *ngIf="!order.fast">
        <div class="container" *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'accepted'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="active">
              تأكيد الطلب
            </li>
            <li class="active" *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'shipping'">
          <ul class="progressbar">
            <li class="">
              تأكيد الطلب
            </li>
            <li class="active">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'pending'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="">
              تأكيد الطلب
            </li>
            <li class="" *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'canceld'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="canceld">
              الطلب ملغي
            </li>
            <li class="active" *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'user_canceld'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="canceld">
              تم الالغاء من قبل العميل
            </li>
            <li *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li>
              قيد التنفيذ
            </li>
          </ul>
        </div>
      </ion-row>

      <ion-row *ngIf="order.fast">
        <div class="container" *ngIf="order.fast && order.fast.status == 'accepted'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="active">
              تأكيد الطلب
            </li>
            <li class="active" *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.fast && order.fast.status == 'shipping'">
          <ul class="progressbar">
            <li class="">
              تأكيد الطلب
            </li>
            <li class="active">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.fast && order.fast.status == 'pending'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="">
              تأكيد الطلب
            </li>
            <li class="" *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.fast && order.fast.status == 'canceld'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="canceld">
              تم الألغاء
            </li>
            <li class="active" *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li class="active">
              قيد التنفيذ
            </li>
          </ul>
        </div>
        <div class="container" *ngIf="order.fast && order.fast.status == 'user_canceld'">
          <ul class="progressbar" [ngClass]="(order.delivery_type == 'market')?'no-shipping':''">
            <li class="canceld">
              تم الالغاء من قبل العميل
            </li>
            <li *ngIf="order.delivery_type == 'delivery'">
              شحن
            </li>
            <li>
              قيد التنفيذ
            </li>
          </ul>
        </div>
      </ion-row>
      <ion-grid>
        <ion-row>
          <hr>
          <ion-col size="12" class="ion-text-right">
            <ion-text style="display: block;" color="primary">
              إسم العميل : <span *ngIf="order.owner"> {{ order.owner.name }}</span><span *ngIf="!order.owner"> عميل
                غير معروف</span>
            </ion-text>
          </ion-col>

          <ion-col size="6" class="ion-text-right">
            <ion-text style="display: block;" color="primary" *ngIf="order.delivery_type == 'market'">
              تاريخ الطلب : <span style="font-size: .8em;"> {{ order.sutiable_time | date: "dd-MM-yyyy , H:mm" }}
              </span>
            </ion-text>
            <ion-text style="display: block;" color="primary" *ngIf="order.delivery_type == 'delivery'">
              تاريخ الطلب : <span style="font-size: .8em;"> {{ order.sutiable_time | date: "dd-MM-yyyy , H:mm" }}
              </span>
            </ion-text>
          </ion-col>
          <ion-col size="6" class="ion-text-left">
            <!-- <ion-text style="display: block;" color="primary">
              <span *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'accepted'"
                style="color: #69bb7b;"> {{ OrderStatus.accepted}} </span>
              <span *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'canceld'" style="color: red;">
                {{ OrderStatus.canceld}} </span>
              <span *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'pending'" style="color: brown;">
                {{ OrderStatus.pending}} </span>
              <span *ngIf="order.orderproducts[0] && order.orderproducts[0].status == 'shipping'"
                style="color: #7D2468;"> {{ OrderStatus.shipping}} </span>
            </ion-text> -->
          </ion-col>
          <ion-col size="6" class="ion-text-right">
            <ion-text style="display: block;" color="primary">
              رقم الطلب : <span> {{ order.id  }} </span>
            </ion-text>
          </ion-col>
          <ion-col size="6" class="ion-text-left">
            <ion-text style="display: block;" color="primary" *ngIf="!order.fast">
              قيمة المبلغ : <span> {{ order.sumOrder}} EGP</span>
            </ion-text>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
  <!-- normal order products -->
  <ng-container *ngIf="order && !order.fast">
    <ion-text class="ion-padding-horizontal">
      تفاصيل المنتج
    </ion-text>
    <ng-container *ngFor="let product of order.products">
      <ion-card color="light">
        <ion-card-content class="ion-no-padding" *ngIf="order">
          <ion-grid>
            <ion-row>
              <ion-col size="3">
                <img *ngIf="product.images && product.images[0]"
                  [src]="ImgeBase + '/'  + product.images[0].for + '/'  + product.images[0].name ">
                <img *ngIf="!product.images || !product.images[0]" src="http://via.placeholder.com/100x100">
              </ion-col>
              <ion-col size="9" class="ion-text-right">
                <ion-text style="display: block;" color="primary">
                  {{product.name}}
                </ion-text>
                <ng-container
                  *ngIf="product.OrderProducts.extra_options&&product.OrderProducts.extra_options.length > 0">
                  <ion-text style="display: block;" color="primary"
                    *ngFor="let option of product.OrderProducts.extra_options">
                    {{ option.name}} : {{ option.user_value}}
                  </ion-text>
                </ng-container>
                <ion-text style="display: block;" color="primary">
                  الكمية : {{ product.OrderProducts.Quantity  }}
                </ion-text>
                <ion-text style="display: block;" color="primary">
                  <!-- {{ product.OrderProducts.Final_Price }} EGP -->
                  {{ product['market'][0]['Market_Products']['Selling_price'] }} EGP
                </ion-text>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card-content>
      </ion-card>
    </ng-container>

    <ion-text class="ion-padding-horizontal" color="primary">
      تفاصيل المبلغ
    </ion-text>
    <ion-card color="light">
      <ion-card-content class="ion-no-padding" *ngIf="order">
        <ion-grid>
          <ion-row>
            <ion-col size="8" class="ion-text-right">
              <ion-text style="display: block;" color="primary">
                سعر المنتج : <span> {{ order.sumallOrder }} EGP</span>
              </ion-text>
              <ion-text style="display: block;" color="primary" *ngIf="order.sumallCoupons && order.sumallCoupons>0">
                كوبون الخصم : <span> {{ order.sumallCoupons}} EGP</span>
              </ion-text>
              <ion-text style="display: block;" color="primary">
                مبلغ الطلب بعد الخصومات : <span> {{ order.sumOrder }} EGP</span>
              </ion-text>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>
  </ng-container>
  <!-- fast order data -->
  <ng-container *ngIf="order && order.fast">
    <ion-text class="ion-padding-horizontal">
      تفاصيل المنتج
    </ion-text>
    <ng-container>
      <ion-card color="light">
        <ion-card-content class="ion-no-padding">
          <ion-grid>
            <ion-row>
              <ion-col size="3" *ngIf="order.fast.image">
                <img [src]="ImgeBase + '/'  + order.fast.image.for + '/'  + order.fast.image.name ">
              </ion-col>
              <ion-col class="ion-text-right">
                <ion-text style="display: block;" color="primary">
                  {{order.fast.description}}
                </ion-text>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card-content>
      </ion-card>
    </ng-container>

    <ion-text class="ion-padding-horizontal">
      تفاصيل المبلغ
    </ion-text>
    <ion-card color="light">
      <ion-card-content class="">
        <ion-row>
          <ion-col size="4" class="vertical-align">
            <p class="vertical-align">
              إجمالي المبلغ :
            </p>
          </ion-col>
          <ion-col>
            <ion-input type="number" placeholder="أكتب المبلغ الإجمالي للطلب" [(ngModel)]="order.total_price">
            </ion-input>
          </ion-col>
        </ion-row>

      </ion-card-content>
    </ion-card>
  </ng-container>

  <ng-container *ngIf="order.OrderDelivery">
    <ion-text class="ion-padding-horizontal">
      بيانات التوصيل :
    </ion-text>
    <ion-card color="light">
      <ion-card-content class="ion-no-padding">
        <ion-grid>
          <ion-row>
            <ion-col size="3">
              <ion-text style="display: block;" color="primary">
                الأسم :
              </ion-text>
            </ion-col>
            <ion-col class="ion-text-right">
              <ion-text style="display: block;" color="primary">
                {{order.OrderDelivery.name}}
              </ion-text>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="3">
              <ion-text style="display: block;" color="primary">
                رقم الهاتف :
              </ion-text>
            </ion-col>
            <ion-col class="ion-text-right">
              <ion-text style="display: block;" color="primary">
                {{order.OrderDelivery.phone}}
              </ion-text>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="3">
              <ion-text style="display: block;" color="primary">
                العنوان :
              </ion-text>
            </ion-col>
            <ion-col class="ion-text-right">
              <ion-text style="display: block;" color="primary">
                {{order.OrderDelivery.address}}
              </ion-text>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>
  </ng-container>


  <ion-grid class="ion-margin-vertical" *ngIf="order && !order.fast">

    <ion-row class="ion-margin-bottom">
      <ion-col size="8" offset="2" *ngIf="order.delivery_type == 'delivery'">
        <ion-button expand="block" color="light"
          [disabled]="order.orderproducts[0].status != 'pending' || order.orderproducts[0].status == 'shipping' || order.orderproducts[0].status == 'user_canceld' "
          (click)="changeStatusByMarket('shipping',false)">شحن الطلب</ion-button>
      </ion-col>
      <ion-col size="8" offset="2">
        <ion-button expand="block" color="light"
          [disabled]="(order.orderproducts[0].status != 'pending'&& (order.orderproducts[0].status != 'shipping' && order.delivery_type == 'delivery')) || order.orderproducts[0].status == 'accepted' || order.orderproducts[0].status == 'user_canceld' || order.orderproducts[0].status == 'canceld'"
          (click)="changeStatusByMarket('accepted',false)">تأكيد أستلام الطلب</ion-button>
      </ion-col>
      <ion-col size="8" offset="2">
        <ion-button expand="block" color="light"
          [disabled]="order.orderproducts[0].status == 'canceld'"
          (click)="changeStatusByMarket('canceld',false)">إلغاء الطلب</ion-button>
      </ion-col>
      <ion-col size="8" offset="2">
        <ion-button expand="block" color="light" [routerLink]="'/chat-room'"
          [queryParams]="{user_id : order.owner?.id , order: order.id}"> تواصل مع العميل</ion-button>
      </ion-col>
      <ion-col class="ion-margin-vertical"></ion-col>
    </ion-row>

  </ion-grid>

  <ion-grid class="ion-margin-vertical" *ngIf="order && order.fast">
    <ion-row class="ion-margin-bottom">
      <ion-col size="8" offset="2" *ngIf="order.delivery_type == 'delivery'">
        <ion-button expand="block" color="light"
          [disabled]="order.fast.status != 'pending' || order.fast.status == 'shipping' || order.fast.status == 'user_canceld'"
          (click)="changeStatusByMarket('shipping',true)">شحن الطلب</ion-button>
      </ion-col>
      <ion-col size="8" offset="2">
        <ion-button expand="block" color="light"
          [disabled]="(order.fast.status != 'pending' && (order.fast.status != 'shipping' && order.delivery_type == 'delivery'))  || order.fast.status == 'accepted'  || order.fast.status == 'user_canceld'  || order.fast.status == 'canceld' "
          (click)="changeStatusByMarket('accepted',true)">تأكيد أستلام الطلب</ion-button>
      </ion-col>
      <ion-col size="8" offset="2">
        <ion-button expand="block" color="light"
          [disabled]="order.fast.status == 'canceld'"
          (click)="changeStatusByMarket('canceld',true)">إلغاء الطلب</ion-button>
      </ion-col>
      <ion-col size="8" offset="2">
        <ion-button expand="block" color="light" [routerLink]="'/chat-room'"
          [queryParams]="{user_id : order.owner?.id , order: order.id}"> تواصل مع العميل</ion-button>
      </ion-col>
      <ion-col class="ion-margin-vertical"></ion-col>
    </ion-row>

  </ion-grid>
  <br><br><br>

</ion-content>